<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telugu Delicacies - Sales</title>
    <!-- Reuse Main Styles -->
    <link rel="stylesheet" href="styles.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Outfit:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">

    <style>
        /* Override/Extended Styles specific to Sales Page but using Variables */
        body {
            background-color: var(--bg-secondary);
        }

        /* Scoped Header for Sales Page if different, otherwise similar to main */
        .sales-header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-light);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .sales-page-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- Layout: Product View --- */
        .grid-layout {
            display: grid;
            grid-template-areas:
                "breadcrumb breadcrumb"
                "main sidebar"
                "recent recent";
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }

        @media (max-width: 900px) {
            .grid-layout {
                grid-template-areas: "breadcrumb" "main" "sidebar" "recent";
                grid-template-columns: 1fr;
            }
        }

        /* Breadcrumb */
        .breadcrumb-section {
            grid-area: breadcrumb;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-light);
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .breadcrumb-link {
            color: var(--text-secondary);
            text-decoration: none;
        }

        .breadcrumb-link:hover {
            color: var(--color-primary-blue);
            text-decoration: underline;
        }

        .breadcrumb-current {
            color: var(--color-primary-blue);
            font-weight: 600;
            margin-left: 5px;
        }

        /* Main Area */
        .main-product-area {
            grid-area: main;
            display: grid;
            grid-template-columns: 45% 1fr;
            gap: 40px;
            background: var(--bg-primary);
            padding: 20px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }

        @media (max-width: 700px) {
            .main-product-area {
                grid-template-columns: 1fr;
            }
        }

        .product-gallery img {
            width: 100%;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
        }

        .product-details {}

        .product-title {
            font-size: 2rem;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        @media (max-width: 480px) {
            .product-title {
                font-size: 1.5rem;
            }
        }

        .telugu-title {
            color: var(--text-muted);
            font-family: var(--font-telugu);
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .price-row {
            display: flex;
            align-items: baseline;
            gap: 10px;
            margin: 1rem 0;
        }

        .current-price {
            color: var(--color-primary-blue);
            font-size: 1.8rem;
            font-weight: 700;
        }

        .mrp-strike {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        .desc-box {
            margin: 1.5rem 0;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Buttons/Tabs */
        .info-btns-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .info-btn {
            background: transparent;
            border: 1px solid var(--border-medium);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: var(--font-primary);
        }

        .info-btn:hover {
            background: var(--bg-secondary);
            color: var(--color-primary-blue);
            border-color: var(--color-primary-blue);
        }

        .info-btn.active {
            background: var(--color-primary-blue);
            color: white;
            border-color: var(--color-primary-blue);
        }

        .info-content-panel {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .buy-action-box {
            margin-top: 20px;
        }

        .buy-btn {
            background: var(--color-success);
            color: white;
            border: none;
            width: 100%;
            padding: 15px;
            border-radius: var(--radius-full);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: var(--shadow-md);
        }

        .buy-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: #0ea874;
        }

        /* Nav Buttons */
        .nav-products-row {
            display: flex;
            gap: 10px;
        }

        .nav-arrow-btn {
            background: white;
            border: 1px solid var(--border-medium);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            font-weight: 500;
            text-decoration: none;
        }

        .nav-arrow-btn:hover {
            border-color: var(--color-primary-blue);
            color: var(--color-primary-blue);
            background: var(--bg-secondary);
        }

        .nav-arrow-btn i {
            font-size: 0.8rem;
        }

        /* Sidebar & Recent */
        .sidebar {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: var(--radius-lg);
            height: fit-content;
            border: 1px solid var(--border-light);
        }

        @media (max-width: 900px) {
            .sidebar {
                margin-top: 20px;
            }
        }

        .sidebar h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-light);
            color: var(--text-primary);
        }

        .sim-item {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.2s;
            border: 1px solid transparent;
        }

        .sim-item:hover {
            background: var(--bg-secondary);
            border-color: var(--border-light);
        }

        .sim-img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid var(--border-light);
        }

        .sim-info {
            flex: 1;
        }

        .sim-info h4 {
            font-size: 0.9rem;
            margin: 0 0 4px;
            color: var(--text-primary);
            font-weight: 500;
            line-height: 1.3;
        }

        .sim-price {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--color-primary-blue);
        }

        .recent-section {
            grid-area: recent;
            background: var(--bg-primary);
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
        }

        .recent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .recent-card {
            text-align: left;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .recent-card:hover {
            transform: translateY(-3px);
        }

        .recent-card img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid var(--border-light);
        }

        .recent-title {
            font-size: 0.9rem;
            color: var(--text-primary);
            font-weight: 500;
            height: 2.8em;
            overflow: hidden;
            line-height: 1.4;
        }

        /* --- Category View --- */
        .category-view-container {
            display: block;
            padding: 20px 0;
            min-height: 70vh;
        }

        .master-cards-grid {
            display: grid;
            grid-template-columns: 1fr;
            /* Mobile First: 1 column */
            gap: 20px;
            margin-top: 20px;
        }

        @media (min-width: 768px) {
            .master-cards-grid {
                grid-template-columns: repeat(3, 1fr);
                /* Desktop: 3 columns */
                gap: 30px;
            }
        }

        .master-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #e2e8f0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            width: 100%;
            /* Full width in grid cell */
            transition: transform 0.2s;
        }

        .master-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Card Faces Context */
        .card-face {
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        .card-hero-image {
            height: 220px;
            width: 100%;
            background: #f8fafc;
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
        }

        .card-hero-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-body {
            padding: 24px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            text-align: center;
        }

        .card-title {
            font-size: 1.5rem;
            color: var(--text-primary);
            font-weight: 700;
            margin-bottom: 8px;
        }

        .dropdown-wrapper {
            margin-top: auto;
            position: relative;
        }

        .product-select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-medium);
            border-radius: 8px;
            background: #f8fafc;
            font-family: inherit;
        }

        .dropdown-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: var(--text-secondary);
        }

        .nut-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        @media (max-width: 400px) {
            .nut-grid {
                grid-template-columns: 1fr;
            }
        }

        .nut-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            border-bottom: 1px dashed var(--border-light);
            padding: 4px 0;
        }
    </style>
</head>

<body>

    <header class="sales-header">
        <div style="display:flex; align-items:center; gap:10px;">
            <!-- Consistent Logo logic from Main Site -->
            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
                alt="Telugu Delicacies Logo" class="logo"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <div class="logo-fallback"
                style="display: none; background:var(--bg-gradient-primary); color:white; width:40px; height:40px; border-radius:8px; align-items:center; justify-content:center; font-weight:bold;">
                TD</div>
            <span class="brand-name">Telugu Delicacies</span>
            <!-- Add script to mimic main site loader if needed, but onerror handles it -->
        </div>
        <a href="/" class="nav-btn">Home</a>
    </header>

    <div class="sales-page-container" id="appContainer">
        <!-- JS will render either Category View or Product View here -->
        <div style="text-align: center; padding: 100px;">
            <i class="fas fa-spinner fa-spin fa-3x" style="color:var(--color-primary-blue)"></i>
        </div>
    </div>

    <script type="module">
        import { supabase } from './lib/supabase.js';

        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        const categorySlug = urlParams.get('category');

        // Globals
        let ALL_PRODUCTS = [];
        let SITE_SETTINGS = {};

        async function init() {
            // Fetch Global Data
            const [settingsRes, productsRes] = await Promise.all([
                supabase.from('site_settings').select('*').single(),
                supabase.from('products').select('*')
            ]);

            SITE_SETTINGS = settingsRes.data || {};
            ALL_PRODUCTS = productsRes.data || [];
            window.globalPlaceholder = SITE_SETTINGS.product_placeholder_url || './images/placeholder-product.jpg';

            if (productId) {
                renderProductView(productId);
            } else if (categorySlug) {
                renderCategoryView(categorySlug);
            } else {
                // Default to All Categories if no params
                renderCategoryView(null);
            }
        }

        // --- Category View ---
        async function renderCategoryView(targetSlug) {
            // Fetch ALL categories
            const { data: categories } = await supabase.from('categories').select('*').order('display_order', { ascending: true });

            if (!categories || categories.length === 0) {
                document.getElementById('appContainer').innerHTML = '<h2>No categories found</h2>';
                return;
            }

            const getCatProducts = (slug) => ALL_PRODUCTS.filter(p => (p.product_category || '').toLowerCase().trim().replace(/\s+/g, '-') === slug);

            const gridHtml = categories.map(cat => {
                const catProducts = getCatProducts(cat.slug);
                return `
                    <div class="master-card" id="card-${cat.slug}">
                        <div class="card-face">
                            <div class="card-hero-image">
                                <img src="${cat.image_url || './images/category_placeholder.jpg'}" alt="${cat.title}" onerror="this.src='./images/placeholder-product-portrait.jpg'">
                            </div>
                            <div class="card-body">
                                <h3 class="card-title">${cat.title}</h3>
                                ${cat.sub_brand ? `<p class="category-sub-brand">${cat.sub_brand}</p>` : ''}
                                <p class="telugu-subtitle">${cat.telugu_title || ''}</p>
                                <p class="card-desc">${cat.description || ''}</p>
                                <div class="dropdown-wrapper">
                                    <select class="product-select" onchange="if(this.value) window.location.href='sales.html?id='+this.value">
                                        <option value="" disabled selected>Select Product</option>
                                        ${catProducts.map(p => `
                                            <option value="${p.id}">${p.product_name} ${p.product_name_telugu ? '(' + p.product_name_telugu + ')' : ''}</option>
                                        `).join('')}
                                    </select>
                                    <i class="fas fa-chevron-down dropdown-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                 `;
            }).join('');

            const html = `
                <div class="breadcrumb-section" style="margin-bottom: 20px;">
                    <a href="/" class="breadcrumb-link">Home</a>
                    <span style="margin:0 5px;">/</span>
                    <span class="breadcrumb-current">All Categories</span>
                </div>
                
                <div class="category-view-container">
                    <div class="master-cards-grid">
                        ${gridHtml}
                    </div>
                </div>
            `;

            document.getElementById('appContainer').innerHTML = html;

            // Scroll to target if exists
            if (targetSlug) {
                setTimeout(() => {
                    const el = document.getElementById(`card-${targetSlug}`);
                    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }


        // --- Product View ---
        async function renderProductView(id) {
            const product = ALL_PRODUCTS.find(p => p.id == id); // Loose match mainly

            if (!product) {
                document.getElementById('appContainer').innerHTML = '<h2>Product not found</h2>';
                return;
            }

            // Get Category for Breadcrumb & Nav
            const catSlug = (product.product_category || '').toLowerCase().trim().replace(/\s+/g, '-');
            const { data: cat } = await supabase.from('categories').select('*').eq('slug', catSlug).single();
            const catTitle = cat ? cat.title : product.product_category;

            // Nav Logic
            const catProducts = ALL_PRODUCTS.filter(p => {
                const pCat = (p.product_category || '').toLowerCase().trim().replace(/\s+/g, '-');
                return pCat === catSlug;
            });
            const currentIndex = catProducts.findIndex(p => p.id === product.id);
            const prevProd = currentIndex > 0 ? catProducts[currentIndex - 1] : null;
            const nextProd = currentIndex < catProducts.length - 1 ? catProducts[currentIndex + 1] : null;

            updateRecentHistory(product);

            // Render Layout
            const container = document.getElementById('appContainer');
            container.innerHTML = `
                <div class="grid-layout">
                    <!-- Breadcrumb + Nav -->
                    <div class="breadcrumb-section" style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <a href="/" class="breadcrumb-link">Home</a>
                            <span style="margin:0 5px;">/</span>
                            <a href="sales.html?category=${catSlug}" class="breadcrumb-link">${catTitle}</a>
                            <span style="margin:0 5px;">/</span>
                            <span class="breadcrumb-current">${product.product_name}</span>
                        </div>
                        <div class="nav-products-row" style="margin:0;">
                            ${prevProd ? `<button onclick="window.location.href='sales.html?id=${prevProd.id}'" class="nav-arrow-btn"><i class="fas fa-chevron-left"></i> Prev</button>` : '<span></span>'}
                            ${nextProd ? `<button onclick="window.location.href='sales.html?id=${nextProd.id}'" class="nav-arrow-btn" style="margin-left:10px;">Next <i class="fas fa-chevron-right"></i></button>` : ''}
                        </div>
                    </div>

                    <!-- Main -->
                    <div class="main-product-area" id="mainContent">
                         ${renderMainContentHTML(product)}
                    </div>

                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <h3>Similar Items</h3>
                        <div id="similarList">${renderSimilarHTML(product, ALL_PRODUCTS)}</div>
                    </aside>

                    <!-- Recent -->
                    <div class="recent-section">
                        <h3>Recently Viewed</h3>
                        <div class="recent-grid" id="recentList">
                             ${renderRecentHTML(product)}
                        </div>
                    </div>
                </div>
            `;

            // Re-bind Toggle function manually or generic script
        }

        function renderMainContentHTML(p) {
            let variants = [];
            try { variants = typeof p.quantity_variants === 'string' ? JSON.parse(p.quantity_variants) : (p.quantity_variants || []); } catch (e) { }

            let priceDisplay = 'Ask for Price';
            let mrpDisplay = '';
            let qtyDisplay = '';

            if (variants.length > 0) {
                const v = variants[0];
                priceDisplay = '₹' + v.price;
                if (v.mrp) mrpDisplay = '₹' + v.mrp;
                qtyDisplay = v.quantity;
            } else if (p.mrp) {
                priceDisplay = '₹' + p.mrp;
            }

            const imgUrl = p.showcase_image || window.globalPlaceholder;

            // Tabs Logic
            let tabsHtml = '';
            let contentHtml = '';
            const addTab = (id, label, icon, content) => {
                tabsHtml += `<button class="info-btn" onclick="openTab('${id}')" id="btn-${id}"><i class="${icon}"></i> ${label}</button>`;
                contentHtml += `<div id="content-${id}" class="info-content-panel" style="display:none;">${content}</div>`;
            };

            if (p.ingredients && p.ingredients.length > 2) addTab('ing', 'Ingredients', 'fas fa-carrot', `<p>${p.ingredients}</p>`);
            if (p.serving_suggestion && p.serving_suggestion.length > 2) addTab('use', 'Usage', 'fas fa-utensils', `<p>${p.serving_suggestion}</p>`);

            if (p.nutrition_info) {
                let n = {};
                try { n = typeof p.nutrition_info === 'string' ? JSON.parse(p.nutrition_info) : p.nutrition_info; } catch (e) { }

                // Helper to safely format value with unit if missing
                const fmt = (val, unit) => {
                    if (!val) return '';
                    const s = String(val).trim();
                    if (s.toLowerCase().endsWith(unit.toLowerCase())) return s;
                    // Check if it has any non-numeric char?
                    if (/[^0-9.]/.test(s)) return s;
                    return s + unit;
                };

                if (n.calories || n.protein || n.serving_size) {
                    let topInfo = '';
                    if (n.serving_size || n.total_servings) {
                        topInfo = `<div style="margin-bottom:10px; font-size:0.9rem; color:var(--text-secondary);">
                            ${n.serving_size ? `<span>Serving Size: <strong>${n.serving_size}</strong></span>` : ''}
                            ${n.serving_size && n.total_servings ? '<span style="margin:0 8px;">|</span>' : ''}
                            ${n.total_servings ? `<span>Servings: <strong>${n.total_servings}</strong></span>` : ''}
                        </div>`;
                    }

                    // Fields mapping: Label -> [Key, Unit]
                    const fields = [
                        ['Calories', 'calories', ''],
                        ['Protein', 'protein', 'g'],
                        ['Total Fat', 'total_fat', 'g'], // New key
                        ['Saturated Fat', 'saturated_fat', 'g'],
                        ['Carbs', 'carbs', 'g'],
                        ['Fiber', 'fiber', 'g'],
                        ['Sugars', 'sugars', 'g'],
                        ['Sodium', 'sodium', 'g']
                    ];

                    // Fallback for old 'fat' key
                    if (n.fat && !n.total_fat) n.total_fat = n.fat;

                    let gridRows = '';
                    fields.forEach(([label, key, unit]) => {
                        if (n[key]) {
                            gridRows += `<div class="nut-row"><span>${label}</span><span>${fmt(n[key], unit)}</span></div>`;
                        }
                    });

                    let content = `${topInfo}<div class="nut-grid">${gridRows}</div>`;
                    if (n.details) content += `<p style="margin-top:10px; font-size:0.9rem;">${n.details}</p>`;

                    addTab('nut', 'Nutrition', 'fas fa-heartbeat', content);
                }
            }

            return `
                <div class="product-gallery">
                    <img src="${imgUrl}" alt="${p.product_name}" onerror="this.onerror=null; this.src='${window.globalPlaceholder}'">
                </div>
                <div class="product-details">
                    <h1 class="product-title">${p.product_name}</h1>
                    <div class="telugu-title">${p.product_name_telugu || p.product_tagline || ''}</div>
                    
                    <div class="price-row">
                        <span class="current-price">${priceDisplay}</span>
                        ${mrpDisplay ? `<span class="mrp-strike">${mrpDisplay}</span>` : ''}
                    </div>

                    <div class="desc-box">
                        <p>${p.product_description || 'Authentic traditional taste.'}</p>
                        ${qtyDisplay ? `<p><strong>Pack Size:</strong> ${qtyDisplay}</p>` : ''}
                    </div>

                    <div class="info-btns-row">${tabsHtml}</div>
                    <div class="info-display-area">${contentHtml}</div>

                    <div class="buy-action-box">
                        <button onclick="window.open('https://wa.me/c/919618519191', '_blank')" class="buy-btn">
                            <i class="fab fa-whatsapp"></i> Buy on WhatsApp
                        </button>
                    </div>
                </div>
            `;
        }

        function renderSimilarHTML(target, all) {
            const blocked = new Set(['salt', 'chilly', 'oil', 'turmeric']);
            const getParts = (str) => {
                if (!str) return [];
                return str.toLowerCase().split(/[,\n]+/).map(s => s.trim()).filter(s => s && !blocked.has(s) && s.length > 2);
            };
            const targetParts = getParts(target.ingredients);

            const recs = all.filter(p => p.id !== target.id).map(p => {
                const pParts = getParts(p.ingredients);
                const intersection = pParts.filter(x => targetParts.some(t => x.includes(t) || t.includes(x)));
                const isSameCat = p.product_category === target.product_category;
                return { ...p, score: (intersection.length * 2) + (isSameCat ? 1 : 0) };
            }).sort((a, b) => b.score - a.score).slice(0, 5);

            return recs.map(r => `
                <div class="sim-item" onclick="window.location.href='sales.html?id=${r.id}'">
                    <img src="${r.showcase_image || window.globalPlaceholder}" class="sim-img" onerror="this.src='${window.globalPlaceholder}'">
                    <div class="sim-info">
                        <h4>${r.product_name}</h4>
                        <div class="sim-price">View</div>
                    </div>
                </div>
            `).join('');
        }

        function updateRecentHistory(product) {
            let history = [];
            try { history = JSON.parse(localStorage.getItem('recentProducts') || '[]'); } catch (e) { }
            history = history.filter(h => h.id !== product.id);
            history.unshift({ id: product.id, name: product.product_name, image: product.showcase_image });
            if (history.length > 8) history.pop();
            localStorage.setItem('recentProducts', JSON.stringify(history));
        }

        function renderRecentHTML(current) {
            let history = [];
            try { history = JSON.parse(localStorage.getItem('recentProducts') || '[]'); } catch (e) { }
            const placeholder = window.globalPlaceholder;

            return history.filter(h => h.id !== current.id).map(h => `
                 <div class="recent-card" onclick="window.location.href='sales.html?id=${h.id}'">
                     <img src="${h.image || placeholder}" onerror="this.src='${placeholder}'">
                     <div class="recent-title">${h.name}</div>
                 </div>
             `).join('');
        }

        window.openTab = function (id) {
            document.querySelectorAll('.info-content-panel').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.info-btn').forEach(el => el.classList.remove('active'));
            const c = document.getElementById(`content-${id}`);
            const b = document.getElementById(`btn-${id}`);
            if (c) c.style.display = 'block';
            if (b) b.classList.add('active');
        }

        init();
    </script>
</body>

</html>